<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>City Digital Twin - Emergency Dashboard</title>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        h1 { color: #333; }
        
        /* Box dello Stato */
        #status-card {
            width: 400px;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            background-color: #4CAF50; /* Verde di default */
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            transition: all 0.5s ease;
        }

        #icon { font-size: 50px; margin-bottom: 10px; display: block;}
        #message { font-size: 18px; margin-top: 10px; }
        #timestamp { font-size: 12px; opacity: 0.8; margin-top: 20px; }

        .normal { background-color: #4CAF50 !important; }
        .critical { background-color: #f44336 !important; animation: pulse 1s infinite; }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <h1>🏙️ Controllo Traffico Cittadino</h1>

    <div id="status-card" class="normal">
        <span id="icon">✅</span>
        <h2 id="title">Tutto Tranquillo</h2>
        <p id="message">Il traffico scorre regolarmente nel Distretto 1.</p>
        <p id="timestamp">In attesa di dati...</p>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <script>
        const socket = io('http://localhost:3000');
        const card = document.getElementById('status-card');
        const title = document.getElementById('title');
        const msg = document.getElementById('message');
        const icon = document.getElementById('icon');
        const time = document.getElementById('timestamp');

        socket.on('connect', () => {
            console.log("Connesso al Server WebSocket!");
        });

        // ASCOLTO DEGLI EVENTI DAL SERVER
        socket.on('alert', (data) => {
            console.log("Alert ricevuto:", data);
            
            if (data.type === 'TRAFFIC_JAM_STARTED') {
                // TRASFORMAZIONE IN ALLARME
                card.className = 'critical';
                icon.innerText = '🚨';
                title.innerText = 'INCIDENTE RILEVATO';
                msg.innerText = data.message;
                time.innerText = 'Rilevato alle: ' + data.timestamp;
            } 
            else if (data.type === 'TRAFFIC_JAM_RESOLVED') {
                // RITORNO ALLA NORMALITA'
                card.className = 'normal';
                icon.innerText = '✅';
                title.innerText = 'Problema Risolto';
                msg.innerText = data.message;
                time.innerText = 'Risolto alle: ' + data.timestamp;
            }
        });
    </script>
</body>
</html>